# part 1
grep -P -e '^(?!.*\[[^]]*(.)(?!\1)(.)\2\1).*(.)(?!\3)(.)\4\3' input.dat -c

# part 2
grep -P -e '(.)(?!\1)(.)\1(?:[^\[\]]*\].*(?!\[)[^\[]*\2\1\2(?=[^\[\]]*\[)|[^\]\[]*\[.*(?!\])[^\]]*\2\1\2(?=[^\[\]]*\]))' input.dat -c
